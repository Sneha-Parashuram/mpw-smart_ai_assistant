{% extends "base.html" %}
{% block title %}Dashboard — Smart Interview-Assistant{% endblock %}
{% block content %}

<div class="dashboard-container">

    <h1 class="dash-title">Your Performance Dashboard</h1>

    <!-- Stats / KPI Cards -->
    <div class="stats-grid">

        <div class="stat-card">
            <h3>Total Answers</h3>
            <p id="total-answers">0</p>
        </div>

        <div class="stat-card">
            <h3>Streak</h3>
            <p id="streak">0</p>
        </div>

        <div class="stat-card">
            <h3>Total Points</h3>
            <p id="points">0</p>
        </div>

        <div class="stat-card">
            <h3>Avg Score</h3>
            <p id="avg-score">0</p>
        </div>

        <!-- ⭐ NEW KPI CARD: Mock Interview Count -->
        <div class="stat-card">
            <h3>Mock Interviews</h3>
            <p id="mock-count">0</p>
        </div>

    </div>

    <!-- Charts -->
    <div class="chart-section">

        <div class="chart-card">
            <h3>Score Trend</h3>
            <canvas id="scoreChart" height="260"></canvas>
        </div>

        <div class="chart-card">
            <h3>Keyword Usage</h3>
            <canvas id="keywordChart" height="260"></canvas>
        </div>

    </div>

</div>


<!-- Load Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {

    const userId = "{{ user_id }}";

    // Fetch progress data
    const res = await fetch(`/get_progress/${userId}`);
    const data = await res.json();

    if (data.status !== "success") return;

    // =====================
    // Update KPI Cards
    // =====================
    document.getElementById("total-answers").textContent = data.total_answers;
    document.getElementById("streak").textContent = data.streak;
    document.getElementById("points").textContent = data.points;

    const avgScore = (
        data.scores.reduce((a, b) => a + b, 0) / (data.scores.length || 1)
    ).toFixed(2);

    document.getElementById("avg-score").textContent = avgScore;

    // ⭐ NEW: Mock interview attempts count
    if (data.mock_interview_count !== undefined) {
        document.getElementById("mock-count").textContent = data.mock_interview_count;
    }

    // Color palette
    const colors = {
        blue: "rgba(13, 110, 253, 0.9)",
        blueLight: "rgba(13, 110, 253, 0.25)",
        orange: "rgba(255, 159, 64, 0.9)"
    };

    // =====================
    // Score Trend Chart
    // =====================
    new Chart(document.getElementById("scoreChart"), {
        type: "line",
        data: {
            labels: data.scores.map((_, i) => `Q${i + 1}`),
            datasets: [{
                label: "Score",
                data: data.scores,
                borderColor: colors.blue,
                backgroundColor: colors.blueLight,
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointBackgroundColor: colors.blue
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    // =====================
    // Keyword Usage Chart
    // =====================
    new Chart(document.getElementById("keywordChart"), {
        type: "bar",
        data: {
            labels: data.keyword_counts.map((_, i) => `Q${i + 1}`),
            datasets: [{
                label: "Keywords Used",
                data: data.keyword_counts,
                backgroundColor: colors.orange,
                borderColor: colors.orange,
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

});
</script>

{% endblock %}
